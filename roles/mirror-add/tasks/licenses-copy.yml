---
- name: make directory for licenses and files
  file:
    path: "{{ item }}"
    state: directory
  loop:
  - /var/licenses
  - /var/files

- name: download certificate from master server
  copy:
    src: /etc/pki/tls/certs/localhost.crt
    dest: /etc/pki/tls/certs/localhost.crt

- name: check if files are to be downloaded
  uri:
    url: "https://{{ masterAddress }}/files/"
    method: HEAD
  register: uriTest
  failed_when: no

- name: download files from http server
  get_url:
    url: "https://{{ masterAddress }}/files/"
    dest: /var/files
  when: uriTest.status < 400

- name: copy license files to remote servers
  copy:
    src: /var/licenses
    dest: /var/licenses
