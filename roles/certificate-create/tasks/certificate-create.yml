---
- name: check if certificate is already present
  stat:
    path: "{{ netPath }}{{ inventory_hostname }}.crt"
  register: cert_exists

- name: remove eventual remains of old key
  file: 
    state: absent
    path: "{{ item }}"
  with_fileglob: "{{ netPath }}{{ inventory_hostname }}.*"
  when: not cert_exists.stat.exists

- name: print ssh connection adress
  debug: var=hostvars[inventory_hostname].ansible_host

- name: create self-signed OpenSSL-certificate csr & key
  command: openssl req -new -newkey rsa:4096 -nodes -keyout "{{ inventory_hostname }}.key" -out "{{ inventory_hostname }}.csr" -subj "/C=US/ST=Denial/L=Springfield/O=Dis/CN={{ hostvars[inventory_hostname].ansible_host }}"
  args:
    chdir: "{{ netPath }}"
  when: not cert_exists.stat.exists

- name: create self-signed OpenSSL-certificate
  command: openssl x509 -req -days 3650 -in "{{ inventory_hostname }}.csr" -signkey "{{ inventory_hostname }}.key" -out "{{ inventory_hostname }}.crt"
  args:
    chdir: "{{ netPath }}"
  when: not cert_exists.stat.exists
