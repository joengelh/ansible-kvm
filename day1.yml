---
- name: set hostname like ansible inventory name
  hosts: vm
  become: yes
  roles:
  - hostname-set
  - yum-update

- name: install and enable kvm
  hosts: kvm
  become: yes
  roles:
  - libvirt-install

- name: install cockpit and all of its dependencies
  hosts: nfs
  become: yes
  roles: 
  - cockpit-install

- name: create CA certificate on every host
  hosts: vm
  become: yes
  roles:
  - certificate-create

- name: provide nfs storage
  hosts: nfs
  become: yes
  roles:
  - nfs-provide

- name: install anydesk
  hosts: nfs
  become: yes
  roles:
  - anydesk-install

- name: mount nfs storage to all hosts
  hosts: vm
  become: yes
  roles:
  - nfs-mount

- name: create software mirror
  hosts: dev7
  become: yes
  roles: 
  - yum-repo-provide

- name: add yum mirror
  hosts: vm
  become: yes
  roles:
  - certificate-download
  - yum-mirror-add

- name: update mirror list and yum repo
  hosts: vm
  become: yes
  roles:
  - yum-update

- name: install docker 
  hosts: docker
  become: yes
  roles:
  - docker-install
  - docker-compose
  tags: docker

- name: set up webserver for local wol
  hosts: docker
  become: yes
  roles:
  - docker-wol-webserver

- name: set up databases
  hosts: docker
  become: yes
  roles:
  - docker-mariadb
  - docker-timescaledb
  tags: never
